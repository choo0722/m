<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>æ–°å¹´ç¥ç¦</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>

<body>
  <div id="popup-layer"></div>

  <div class="modal-backdrop" id="start-modal">
    <div class="modal">
      <div class="titlebar">
        <span class="icon">ğŸ€</span>
        <span class="title">Toï¼š win nk</span>
      </div>
      <div class="content">
        ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼ŒæŸ¥çœ‹æ¸©é¦¨æç¤º~
      </div>
      <div class="actions">
        <button class="btn primary" onclick="startPopupEffect()">å¼€å§‹å±•ç¤º</button>
      </div>
    </div>
  </div>

  <audio id="localMusic" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg"> æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
  </audio>

  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <script>
    let pyodide;
    const localMusic = document.getElementById('localMusic');

    // åˆå§‹åŒ–Pyodide
    async function initPyodide() {
      pyodide = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/" });
      console.log("Pyodideåˆå§‹åŒ–å®Œæˆ");
    }

    window.onload = initPyodide;

    async function startPopupEffect() {
      document.getElementById("start-modal").style.display = "none";
      resetPopups();
      playLocalMusic();

      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;
      const popupLayer = document.getElementById("popup-layer");

      // === ä¿®å¤é…ç½® ===
      const isMobile = windowWidth < 768;
      // é™ä½ä¸€ç‚¹ç¼©æ”¾æ¯”ä¾‹ï¼Œç»™å¸ƒå±€ç•™å‡ºç©ºé—´ (1.25å€è¶³å¤Ÿå¤§äº†)
      const scaleRatio = isMobile ? 1.25 : 1.0;

      const pythonCode = `
        import random

        width = ${windowWidth}
        height = ${windowHeight}
        is_mobile = ${isMobile ? 'True' : 'False'}

        texts = [    'è®°å¾—åŠ è¡£ï¼',    'è®°å¾—ç…§é¡¾å¥½è‡ªå·±',    'å¤©å¤©å¼€å¿ƒ',    'å¥½å¥½åƒé¥­',    'æ—©ç‚¹ä¼‘æ¯',    'åˆ«æ„Ÿå†’',    'è¦ç›¸ä¿¡è‡ªå·±å¥¥',
            'æ„¿æ‰€æœ‰çƒ¦æ¼éƒ½æ¶ˆå¤±',    'æ¯å¤©éƒ½è¦å…ƒæ°”æ»¡æ»¡',    'ä¿æŒå¾®ç¬‘å‘€',    'é¡ºé¡ºåˆ©åˆ©',    'é‡‘æ¦œé¢˜å',    'æœŸå¾…ä¸‹ä¸€æ¬¡è§é¢',
            'å¥½å¥½çˆ±è‡ªå·±',    'çæƒœæ¯ä¸€åˆ»',    'åˆ«ç†¬å¤œ',    'å­¦ä¼šçˆ±è‡ªå·±',    'ä½ è¶…æ£’çš„',    'ä¿æŒå¥½å¿ƒæƒ…',    'å¤šå–æ¸©æ°´å“¦']

        themes = [
            'theme-blue', 'theme-green', 'theme-orange', 'theme-purple', 'theme-pink',
            'theme-yellow', 'theme-cyan', 'theme-lime', 'theme-red', 'theme-teal',
            'theme-indigo', 'theme-amber', 'theme-rose', 'theme-mint', 'theme-peach',
            'theme-lavender', 'theme-coral', 'theme-sky', 'theme-lemon'
        ]

        animations = [
            'anim-top', 'anim-bottom', 'anim-left', 'anim-right',
            'anim-topleft', 'anim-topright', 'anim-bottomleft', 'anim-bottomright'
        ]

        popup_params = []
        for _ in range(150):
            # === æ ¸å¿ƒä¿®å¤é€»è¾‘ ===
            if is_mobile:
                # æ‰‹æœºç«¯ï¼šä¸ºäº†é˜²æ­¢æŒ¤åœ¨å·¦è¾¹ï¼Œæˆ‘ä»¬å…è®¸å¼¹çª—å‡ºç°åœ¨å±å¹•å®½åº¦çš„ 0% åˆ° 70% ä¹‹é—´
                # è¿™æ ·å³ä½¿å³è¾¹ç¨å¾®è¶…å‡ºå±å¹•ä¸€ç‚¹ï¼Œä¹Ÿæ¯”æŒ¤åœ¨å·¦è¾¹å¥½
                max_x = int(width * 0.8)
                x = random.randint(0, width-200)
                y = random.randint(0, height-50)
            else:
                # ç”µè„‘ç«¯
                max_x = width - 230
                if max_x < 0: max_x = 0
                x = random.randint(0, max_x)
                y = random.randint(0, height - 100)

            text = random.choice(texts)
            theme = random.choice(themes)
            anim = random.choice(animations)
            popup_params.append((x, y, text, theme, anim))

        popup_params
      `;

      const pythonResult = await pyodide.runPythonAsync(pythonCode);
      const popupParams = Array.from(pythonResult);

      popupParams.forEach(([x, y, text, theme, anim], index) => {
        setTimeout(() => {
          const popup = document.createElement('div');
          popup.className = `popup ${theme} ${anim}`;

          popup.style.left = `${x}px`;
          popup.style.top = `${y}px`;

          // æ‰‹æœºç«¯æ”¾å¤§å¤„ç†
          if (isMobile) {
            popup.style.transform = `scale(${scaleRatio})`;
            popup.style.transformOrigin = 'top left';
            // å¢åŠ ä¸€ç‚¹z-indexéšæœºæ€§ï¼Œè®©é‡å æ›´è‡ªç„¶
            popup.style.zIndex = index + 100;
          }

          popup.innerHTML = `
            <div class="header">
                <span class="icon">ğŸ’–</span>
                <span class="title">Toï¼šwin nk</span>
            </div>
            <div class="content">${text}</div>
          `;
          popupLayer.appendChild(popup);
        }, index * 150); //ç¨å¾®æ”¾æ…¢ä¸€ç‚¹å‡ºç°é€Ÿåº¦
      });
    }

    function playLocalMusic() {
      localMusic.play().catch(err => {
        document.body.addEventListener('click', () => {
          localMusic.play();
        }, { once: true });
      });
    }

    function resetPopups() {
      document.getElementById("popup-layer").innerHTML = "";
      localMusic.pause();
      localMusic.currentTime = 0;
    }
  </script>
</body>

</html>



