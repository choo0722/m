<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>ç«‹å†¬</title>
  <!-- å¤–éƒ¨å¼•å…¥æ ·å¼æ–‡ä»¶ -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- å¼¹çª—å®¹å™¨ï¼ˆç”¨äºç»Ÿä¸€ç®¡ç†å¼¹çª—å±‚çº§ï¼‰ -->
  <div id="popup-layer"></div>

  <!-- å…¥åœºæ¨¡æ€æ¡†ï¼ˆä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼‰ -->
  <div class="modal-backdrop" id="start-modal">
    <div class="modal">
      <div class="titlebar">
        <span class="icon">â„ï¸</span>
        <span class="title">Toï¼š xxx</span>
      </div>
      <div class="content">
        ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼ŒæŸ¥çœ‹æ¸©é¦¨æç¤º~
      </div>
      <div class="actions">
        <button class="btn primary" onclick="startPopupEffect()">å¼€å§‹å±•ç¤º</button>
      </div>
    </div>
  </div>

  <!-- æœ¬åœ°éŸ³ä¹æ’­æ”¾å™¨ï¼ˆéšè—å¼ï¼‰ -->
  <audio id="localMusic" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg"> <!-- æ›¿æ¢ä¸ºä½ çš„æœ¬åœ°MP3æ–‡ä»¶è·¯å¾„ -->
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
  </audio>

  <!-- å¼•å…¥Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <script>
    let pyodide;
    const localMusic = document.getElementById('localMusic'); // è·å–éŸ³ä¹å…ƒç´ 

    // åˆå§‹åŒ–Pyodide
    async function initPyodide() {
      pyodide = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.23.4/full/" });
      console.log("Pyodideåˆå§‹åŒ–å®Œæˆ");
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.onload = initPyodide;

    // å¼€å§‹å¼¹çª—æ•ˆæœ
    async function startPopupEffect() {
      // éšè—å…¥åœºæ¨¡æ€æ¡†
      document.getElementById("start-modal").style.display = "none";
      // æ¸…é™¤ç°æœ‰å¼¹çª—
      resetPopups();

      // æ’­æ”¾æœ¬åœ°éŸ³ä¹ï¼ˆå¤„ç†æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
      playLocalMusic();

      // è·å–æµè§ˆå™¨çª—å£å°ºå¯¸
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;
      // å¼¹çª—å®¹å™¨
      const popupLayer = document.getElementById("popup-layer");

      // Pythonä»£ç ï¼šç”Ÿæˆå¼¹çª—å‚æ•°ï¼ˆä½ç½®ã€ä¸»é¢˜ã€æ–‡æœ¬ï¼‰
      const pythonCode = `
        import random

        # çª—å£å°ºå¯¸
        width = ${windowWidth}
        height = ${windowHeight}

        # æç¤ºæ–‡å­—åˆ—è¡¨
        texts = [    'è®°å¾—åŠ è¡£ï¼',    'è®°å¾—ç…§é¡¾å¥½è‡ªå·±',    'å¤©å¤©å¼€å¿ƒ',    'å¥½å¥½åƒé¥­',    'æ—©ç‚¹ä¼‘æ¯',    'åˆ«æ„Ÿå†’',    'è¦ç›¸ä¿¡è‡ªå·±å¥¥',
            'æ„¿æ‰€æœ‰çƒ¦æ¼éƒ½æ¶ˆå¤±',    'æ¯å¤©éƒ½è¦å…ƒæ°”æ»¡æ»¡',    'ä¿æŒå¾®ç¬‘å‘€',    'é¡ºé¡ºåˆ©åˆ©',    'é‡‘æ¦œé¢˜å',    'æœŸå¾…ä¸‹ä¸€æ¬¡è§é¢',
            'å¥½å¥½çˆ±è‡ªå·±',    'çæƒœæ¯ä¸€åˆ»',    'åˆ«ç†¬å¤œ',    'å­¦ä¼šçˆ±è‡ªå·±',    'ä½ è¶…æ£’çš„',    'ä¿æŒå¥½å¿ƒæƒ…',    'å¤šå–æ¸©æ°´å“¦']
 

        # å¼¹çª—ä¸»é¢˜ï¼ˆå¯¹åº”styles.cssä¸­çš„ä¸»é¢˜ç±»ï¼‰
        themes = [
            'theme-blue', 'theme-green', 'theme-orange', 'theme-purple', 'theme-pink',
            'theme-yellow', 'theme-cyan', 'theme-lime', 'theme-red', 'theme-teal',
            'theme-indigo', 'theme-amber', 'theme-rose', 'theme-mint', 'theme-peach',
            'theme-lavender', 'theme-coral', 'theme-sky', 'theme-lemon'
        ]

        # å¼¹çª—åŠ¨ç”»ï¼ˆå¯¹åº”styles.cssä¸­çš„åŠ¨ç”»ç±»ï¼‰
        animations = [
            'anim-top', 'anim-bottom', 'anim-left', 'anim-right',
            'anim-topleft', 'anim-topright', 'anim-bottomleft', 'anim-bottomright'
        ]

        # ç”Ÿæˆ150ä¸ªå¼¹çª—å‚æ•°
        popup_params = []
        for _ in range(150):
            # éšæœºä½ç½®ï¼ˆé€‚é…çª—å£å°ºå¯¸ï¼Œé¿å…å¼¹çª—è¶…å‡ºå±å¹•ï¼‰
            x = random.randint(0, width - 230)
            y = random.randint(0, height - 100)
            # éšæœºæ–‡æœ¬ã€ä¸»é¢˜ã€åŠ¨ç”»
            text = random.choice(texts)
            theme = random.choice(themes)
            anim = random.choice(animations)
            popup_params.append((x, y, text, theme, anim))

        popup_params
                    `;

      // æ‰§è¡ŒPythonä»£ç å¹¶è½¬æ¢ä¸ºJSæ•°ç»„
      const pythonResult = await pyodide.runPythonAsync(pythonCode);
      const popupParams = Array.from(pythonResult);

      // åˆ›å»ºå¼¹çª—å¹¶æ·»åŠ åˆ°å®¹å™¨
      popupParams.forEach(([x, y, text, theme, anim], index) => {
        setTimeout(() => {
          const popup = document.createElement('div');
          // åº”ç”¨æ ·å¼ç±»ï¼ˆåŸºç¡€æ ·å¼+ä¸»é¢˜+åŠ¨ç”»ï¼‰
          popup.className = `popup ${theme} ${anim}`;
          // è®¾ç½®ä½ç½®
          popup.style.left = `${x}px`;
          popup.style.top = `${y}px`;
          // å¼¹çª—å†…å®¹ï¼ˆç¬¦åˆstyles.cssä¸­çš„ç»“æ„ï¼‰
          popup.innerHTML = `
                        <div class="header">
                            <span class="icon">ğŸ’–</span>
                            <span class="title">Toï¼šxxx</span>
                        </div>
                        <div class="content">${text}</div>
                    `;
          // æ·»åŠ åˆ°å®¹å™¨
          popupLayer.appendChild(popup);
        }, index * 100); // é—´éš”100msåˆ›å»ºï¼Œé¿å…å¡é¡¿
      });
    }

    // æ’­æ”¾æœ¬åœ°éŸ³ä¹ï¼ˆå¤„ç†æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾é™åˆ¶ï¼‰
    function playLocalMusic() {
      localMusic.play().catch(err => {
        console.log("è‡ªåŠ¨æ’­æ”¾éœ€è¦ç”¨æˆ·äº¤äº’ï¼Œç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®ç»§ç»­...");
        // é¦–æ¬¡ç‚¹å‡»é¡µé¢åè§¦å‘æ’­æ”¾
        document.body.addEventListener('click', () => {
          localMusic.play();
        }, { once: true });
      });
    }

    // é‡ç½®å¼¹çª—ï¼ˆæ¸…é™¤æ‰€æœ‰å¼¹çª—ï¼‰
    function resetPopups() {
      const popupLayer = document.getElementById("popup-layer");
      popupLayer.innerHTML = "";
      // é‡ç½®éŸ³ä¹ï¼ˆå¯é€‰ï¼‰
      localMusic.pause();
      localMusic.currentTime = 0;
    }
  </script>
</body>

</html>